<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Teacher Dashboard</title>
</head>
<body>
    <h1>Welcome, {{ user.first_name }}</h1>
    <a href="{% url 'logout' %}">Logout</a> | 
    <a href="{% url 'change_password' %}">Change Password</a>
    <hr>
    
    <h2>Labs You Manage</h2>
    {% if labs %}
        <ul>
            {% for lab in labs %}
                <li>
                    <strong>
                        <a href="{% url 'teacher_lab_detail' lab.lab_id %}">
                            Manage Lab: {{ lab.lab_adi }}
                        </a>
                    </strong>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>You are not currently assigned to manage any labs.</p>
    {% endif %}
    
    <hr>

    <h2 style="color:orange;">Pending Reservation Requests</h2>
    {% if pending_reservations %}
        <table border="1" style="width:100%; text-align: left;">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Lab</th>
                    <th>Computer</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for res in pending_reservations %}
                    <tr>
                        <td>{{ res.ogrenci.user.username|default:"-- Teacher Reservation --" }}</td>
                        <td>{{ res.bilgisayar.lab.lab_adi }}</td>
                        <td>{{ res.bilgisayar.computer_name }}</td>
                        <td>{{ res.tarih }}</td>
                        <td>From {{ res.baslangic_saati }} to {{ res.bitis_saati }}</td>
                        <td>
                            <form method="post" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="reservation_id" value="{{ res.rezervasyon_id }}">
                                <button type="submit" name="approve_reservation" style="color:green;">Approve</button>
                            </form>
                            <form method="post" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="reservation_id" value="{{ res.rezervasyon_id }}">
                                <button type="submit" name="reject_reservation" style="color:red;">Reject</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>There are no pending reservation requests at the moment.</p>
    {% endif %}

    <hr>

    <h2 style="color:green;">Approved Reservations</h2>
    {% if approved_reservations %}
        <table border="1" style="width:100%; text-align: left;">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Lab</th>
                    <th>Computer</th>
                    <th>Date</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for res in approved_reservations %}
                    <tr style="background-color:#e0ffe0;">
                        <td>{{ res.ogrenci.user.username|default:"-- Teacher Reservation --" }}</td>
                        <td>{{ res.bilgisayar.lab.lab_adi }}</td>
                        <td>{{ res.bilgisayar.computer_name }}</td>
                        <td>{{ res.tarih }}</td>
                        <td>From {{ res.baslangic_saati }} to {{ res.bitis_saati }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>There are no approved reservations at the moment.</p>
    {% endif %}

    <hr>

    <h2 style="color:red;">Rejected Reservation Log</h2>
    {% if rejected_reservations %}
        <table border="1" style="width:100%; text-align: left;">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Lab</th>
                    <th>Computer</th>
                    <th>Date</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for res in rejected_reservations %}
                    <tr style="background-color:#ffe0e0;">
                        <td>{{ res.ogrenci.user.username|default:"-- Teacher Reservation --" }}</td>
                        <td>{{ res.bilgisayar.lab.lab_adi }}</td>
                        <td>{{ res.bilgisayar.computer_name }}</td>
                        <td>{{ res.tarih }}</td>
                        <td>From {{ res.baslangic_saati }} to {{ res.bitis_saati }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>There are no rejected reservations in the log.</p>
    {% endif %}

</body>
</html>
